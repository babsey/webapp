<script type="text/javascript">
    $( ".portlet-header" ).find( ".ui-icon-newwin" ).live('click', function(e) {
            e.preventDefault();
            var popup = $( this ).parents( ".portlet" );
            width = ($(popup).find( ".portlet-content" ).width()+80);
            height = ($(popup).find( ".portlet-content" ).height()+110);
            newPopup = window.open('{% url network_layout network_obj.SPIC_id network_obj.local_id %}',
                        'network_layout',
                        'left=50,width='+ width.toString() +',height='+ height.toString() +',toolbar=no,location=yes,directories=no,status=no,menubar=no,scrollbars=no,copyhistory=no');
            newPopup.moveTo(screen.availWidth/2 - width/2, screen.availHeight/2 - height /2);
            newPopup.focus();
//             $( popup ).find( ".toggle" ).toggleClass( "ui-icon-minusthick" ).toggleClass( "ui-icon-plusthick" );
//             $( popup ).find( ".portlet-content" ).slideToggle();
    });

    $( "button#save-layout" ).live('click', function(e) {
            e.preventDefault();
            var devices_json = JSON.stringify(device_list);
            $.post('{% url save_layout network_obj.id %}',
                    {'csrfmiddlewaretoken':"{{ csrf_token }}", 'devices_json':devices_json},
                    function(data) {
                        layoutSize = data["layoutSize"];
                        $( "#holder" ).height(layoutSize["y"]+30)
                                      .width(layoutSize["x"]+30)
                                      .html('')
                                      .loadLayout(device_list);
                        $( "#position" ).html("saved").show();
            }, 'json');
    });

    $( "button#default-layout" ).live('click', function(e) {
            e.preventDefault();
            $.getJSON('{% url default_layout network_obj.id %}', //'/network/ajax/'+ {{ network_obj.id }} +'/default_layout/',
                                        function(data) {
                                            device_list = data["device_list"];
                                            layoutSize = data["layoutSize"];
                                            $( "#holder" ).height(layoutSize["y"]+30)
                                                          .width(layoutSize["x"]+30)
                                                          .html('')
                                                          .loadLayout(device_list);
                                    });
    });

    $( "button#layout-legend" ).live('click', function() {
        $(this).toggleClass("ui-state-highlight");
        $( "div#layout-legend-content" ).slideToggle();
    });

    $(document).ready(function() {

        if (neuron_ids.length > 0) {
            $( "#holder" ).loadLayout( device_list );
        } else {
            $( "#holder" ).parents( ".portlet" ).hide();
        }
       
    });


</script>

<div class="portlet" id="network_layout">
    <div class="portlet-header portlet-toggle" title="">
        Network layout
        <span class="ui-icon dialog ui-icon-newwin" style="float:right"></span>
    </div>

    <div class="portlet-content">
        <div id=holder></div>

        <div class="buttons">
            <button class="check" id="save-layout">Save</button>
            <button class="reset" id="default-layout">Default</button>
            <button id="layout-legend">Legend</button>
            <small style="float:right" id="position"></small>
        </div>

    </div>

    <div class="portlet-content collapse" id="layout-legend-content">
        <p><b>blue line</b> - excitatory connection</p>
        <p><b>red line</b> - inhibitory connection</p>
        <p><b>left dot</b> - then neuron receives external input.</p>
        <p><b>right dot</b> - then neurons are being recorded.</p>
        <br>
        <p><b>NOTE</b>: neurons can be dragged around.</p>
    </div>
</div>