{% if network_obj.is_recorded %}
    {% if network_obj.has_spike_detector %}
        <script type="text/javascript" src="{{ MEDIA_URL }}js/d3.spike_detector.js"></script>
    {% endif %}

    <script type="text/javascript">


        {% if network_obj.has_voltmeter %}

            function voltmeter_enlarge(target_id) {
                $( ".resultView" ).attr('src', '/network/ajax/{{ network_obj.pk }}/voltmeter/?neuron='+ target_id);
                $( ".resultView" ).css('height', 400);

                $( "#dialog-resultView" ).dialog({
                        title: 'Voltmeter view of Neuron ['+ target_id +']',
                        height: 470,
                        width: window.innerWidth - 10,
//                         modal: true,
                });
            };

            $( "button#reload" ).live('click', function(e) {
                    $( "div#VoltmeterThumbnail" ).html('<iframe src="{% url voltmeter_thumbnail network_obj.pk %}"> </iframe>');
            });

            $( "select#voltmeter-select" ).live('change',function(e) {
                    voltmeter_enlarge($(this).val())
                    $( "#voltmeter-select option:first" ).attr('selected', 'selected');
            });

        {% endif %}


        $(document).ready(function() {

            {% if network_obj.has_spike_detector %}
                loadSpikeDetector();
                figures["spikeDetectorThumbnail"] = drawSpikeDetector("spikeDetectorThumbnail");

                $( "#spikeDetectorThumbnail" ).find( ".fig" ).click(function() {

                    $( "#spikeDetectorView" ).dialog({
                        title: 'Spike Detector view of all connected neurons',
                        height: window.innerHeight - 200,
                        width: window.innerWidth - 10,
                        resizable: false,
                        modal: true,
                    });

                    figures["spikeDetectorView"] = drawSpikeDetector("spikeDetectorView")
                });
            {% endif %}

        })

    </script>


<!--             SPIKE DETECTOR thumbnail -->
<div style="float:left">
    {% if network_obj.has_spike_detector %}
       <div style="width: 250px; text-align: center; font-weight:bold">Spike Detector</div>

        <div class="ui-widget spikeDetector" id="spikeDetectorThumbnail" >
            {% if spike_detector.times %}
                {% include "d3.spike_detector.html" %}
            {% else %}
                <div style="padding-top: 20px; text-align:center">No spikes detected. Check your input devices.</div>
            {% endif %}
        </div>
    {% endif %}
</div>


<!--             VOLTMETER iframe -->
<div style="float:left">
    {% if network_obj.has_voltmeter %}
       <div style="width: 380px; text-align: center; font-weight:bold">Voltmeter</div>
            {% if network_obj.voltmeter_points < 15000 %}

                <iframe style="margin:1px; height: 210px; width:320px; padding: 5px; border: 1px solid #ccc" id="VoltmeterThumbnail"></iframe>

            {% else %}

                The number of points is too big.

                <div class="field-wrapper" title="">

                    <label for="voltmeter-select">View larger screen</label>

                    <select id="voltmeter-select">
                        <option>--- Select a neuron ---</option>

                        {% for targets in network_obj.voltmeter_targets %}
                            <option value="{{targets}}">
                                Neuron [{{targets}}]
                            </option>
                        {% endfor %}

                    </select>

                </div>

            {% endif %}

    {% endif %}
</div>

<div style="position:absolute; bottom: 5px; right: 10px">
    <a class="document" href="{% url data network_obj.pk %}">Download Results</a>
</div>

<div class="ui-dialog spikeDetector" id="spikeDetectorView" style="display:none; z-index:-1">
    {% include "d3.spike_detector.html" %}
</div>

<div class="ui-dialog" title="result view" id="dialog-resultView" style="z-index:-1">

    <iframe class="resultView" scrolling="no"></iframe>

</div>
{% endif %}