{% if network_obj.is_recorded %}
    {% if network_obj.has_spike_detector %}
        <script type="text/javascript" src="{{ MEDIA_URL }}js/d3.spike_detector.js"></script>
    {% endif %}

    <script type="text/javascript">

        $(function() {

                $( "div#results-tabs" ).tabs({cookie: { expires: 7, name: "results-cookie"}, cache: false});

        });

        {% if network_obj.has_voltmeter %}

            function voltmeter_enlarge(target_id) {
                $( ".resultView" ).attr('src', '/network/ajax/{{ network_obj.pk }}/voltmeter/?neuron='+ target_id);
                $( ".resultView" ).css('height', 400);

                $( "#dialog-resultView" ).dialog({
                        title: 'Voltmeter view of Neuron ['+ target_id +']',
                        height: 470,
                        width: 800,
//                         modal: true,
                });
            };

            $( "button#reload" ).live('click', function(e) {
                    $( "div#VoltmeterThumbnail" ).html('<iframe src="{% url voltmeter_thumbnail network_obj.pk %}"> </iframe>');
            });

            $( "select#voltmeter-select" ).live('change',function(e) {
                    voltmeter_enlarge($(this).val())
                    $( "#voltmeter-select option:first" ).attr('selected', 'selected');
            });

        {% endif %}


        {% if network_obj.has_spike_detector %}

            $( "button#spike_detector-link" ).live('click',function(e) {
                $( ".resultView" ).attr('src', "{% url spike_detector network_obj.pk %}?view=large");
                $( ".resultView" ).css('height', {{ network_obj.neuron_ids|length }} * 15 + 230);

                $( "#dialog-resultView" ).dialog({
                        title: 'Spike Detector view of all connected neurons',
                        height: {{ network_obj.neuron_ids|length }} * 15 + 320,
                        width: 800,
//                         modal: true,
                });
            });

        {% endif %}


        $(document).ready(function() {

            {% if network_obj.has_voltmeter %}
                setTimeout('$( "#VoltmeterThumbnail" ).contents().find("span").each(function() {$(this).click(function() {voltmeter_enlarge(this.id)})})', 2500.)
            {% endif %}


            {% if network_obj.has_spike_detector %}
                    loadSpikeDetector();
                    figures["spikeDetectorThumbnail"] = drawSpikeDetector("spikeDetectorThumbnail");

                    $( "#spikeDetectorThumbnail" ).find( ".fig" ).click(function() {

                        $( "#spikeDetectorView" ).dialog({
                            title: 'Spike Detector view of all connected neurons',
                            height: window.innerHeight - 200,
                            width: window.innerWidth - 200,
                            resizable: false,
                            modal: true,
                        });
                        figures["spikeDetectorView"] = drawSpikeDetector("spikeDetectorView")
                    });
            {% endif %}

            $( ".portlet-content" ).removeClass("ui-corner-all")
            
        })
    </script>


    <div class="portlet" id="result">

        <div class="portlet-header portlet-toggle" title="Simulation was succeed. So you can explore the view of results.">
            Results
        </div>

        <div class="portlet-content" id="results-tabs">

            <ul>
                {% if network_obj.has_spike_detector %}
                    <li><a href="#spike_detector-tab" class="spike_detector-tab">Spike Detector</a></li>
                {% endif %}
                {% if network_obj.has_voltmeter %}
                    <li><a href="#voltmeter-tab" class="voltmeter-tab-header">Voltmeter</a></li>
                {% endif %}
            </ul>

<!--             SPIKE DETECTOR TAB -->
            <div id="spike_detector-tab">
                {% if network_obj.has_spike_detector %}
                    <div class="spikeDetector" id="spikeDetectorThumbnail">
                          {% if spike_detector.times %}
                              {% include "d3.spike_detector.html" %}
                          {% else %}
                              <div style="padding-top: 20px; text-align:center">No spikes detected. Check your input devices.</div>
                          {% endif %}
                    </div>
                {% endif %}
            </div>

<!--             VOLTMETER TAB -->
            <div id="voltmeter-tab">
                {% if network_obj.has_voltmeter %}
                    <div>
                        {% if network_obj.voltmeter_points < 15000 %}

                            <iframe src="{% url voltmeter_thumbnail network_obj.pk %}" id="VoltmeterThumbnail"></iframe>

                        {% else %}

                            The number of points is too big.

                            <div class="field-wrapper" title="">

                                <label for="voltmeter-select">View larger screen</label>

                                <select id="voltmeter-select">
                                    <option>--- Select a neuron ---</option>

                                    {% for targets in network_obj.voltmeter_targets %}
                                        <option value="{{targets}}">
                                            Neuron [{{targets}}]
                                        </option>
                                    {% endfor %}

                                </select>

                            </div>

                        {% endif %}
                    </div>

                    <div class="buttons" style="font-size:1em">

                        <button id="reload">Reload</button>

                    </div>

                {% endif %}
            </div>

            <div class="buttons" style="font-size:1em">

                <a class="document" href="{% url data network_obj.pk %}">Download Results</a>

            </div>

        </div>

    </div>


<div class="ui-dialog spikeDetector" id="spikeDetectorView" style="display:none">
    {% include "d3.spike_detector.html" %}
</div>

<div class="ui-dialog" title="result view" id="dialog-resultView" style="width:0">

    <iframe class="resultView" scrolling="no"></iframe>

</div>


{% endif %}