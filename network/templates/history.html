<script type="text/javascript">

    $(function() {

            $( "ul#history-list" ).quickPager();

    });

    $(document).ready(function() {


        $( "#history_"+ result_id).addClass( "ui-state-highlight" );

        $( "ul#history-list li" ).each(function(){
            $( this ).addClass("ui-widget-content");
        });

        $( "#history-list li" ).hover(
            function(){
                $( this ).addClass("ui-state-hover");
            },function(){
                $( this ).removeClass("ui-state-hover");
        });

        $( "ul#history-list div.version-link" ).click(function (e) {
                $( "#dialog-msg p" ).html("Loading... please wait.");
                $( "#dialog-msg #loading_icon" ).show();
                $( "#dialog-msg" ).dialog({
                        height: 150,
                        resizable: false,
                        modal: true,
                });
                window.location.href = $( this ).find( "a" ).attr('href')
        });

        $( "button#go-versions" ).click(function(e) {
                e.preventDefault();
                if ($( "ul#history-list input" ).is(":checked")) {
                    $( ".versions-form" ).submit();
                };
        });

    })
</script>

<div class="portlet" id="history">
    <div class="portlet-header portlet-toggle" title="Click a simulated network version to load it.">
        History
    </div>

    <div class="portlet-content">

        <form action="." method="POST" class="versions-form">
            {% csrf_token %}
            <ul class="pager" id="history-list">
                {% for result in results %}
                      <li class="tipTip-left"
                        title="{{result.comment|default_if_none:'no comment'}}" id="history_{{result.local_id|default:0}}">
                        <input style="float:right" type="checkbox" name="result_ids" value="{{result.id}}">
                        {% if result.favorite %}<div class="ui-icon ui-icon-star" style="float:right"></div>{% endif %}
                        <div class="version-link">
                            <a href="{% url network_simulated network_obj.SPIC_id network_obj.local_id result.local_id|default:0 %}?version=revert" id="{{result.local_id}}">
                                {% if result %}
                                    <b>{{ result.local_id }}</b> -
                                    {% if result.date_simulated %}
                                        {% if result.has_spike_detector %} [Sd] {% endif %}
                                        {% if result.has_voltmeter %} [Vm] {% endif %}
                                        - {{ result.date_simulated|timesince }} ago
                                    {% else %}
                                        no simulation
                                    {% endif %}
                                {% else %}
                                    NaN - no result found
                                {% endif %}
                            </a>
                        </div>
                    </li>
                {% endfor %}

                <li class="tipTip-left"
                    title="" id="history_0">
                    <div class="version-link">
                        <a href="{% url network network_obj.SPIC_id network_obj.local_id %}?version=first">
                            Initial version of network
                        </a>
                    </div>
                </li>
            </ul>

            <div class="buttons field-wrapper" title="" >
                <button class="go" id="go-versions" style="float:right">Go</button>
                <form action="#">
                    <select name="action" id="versions-select">
                        <option>Select an action</option>
                        <option value="delete">Delete</option>
                        <option value="favorite">Mark as favorite</option>
                        <option value="unfavorite">Unmark as favorite</option>
                    </select>

                </form>
            </div>
        </form>
    </div>
</div>