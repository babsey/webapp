<html>
  <head>
    <title>Scatterplot</title>
    <link rel="stylesheet" href="/media/css/result.css"></link>
    <script type="text/javascript" src="/media/js/jquery-1.6.2.min.js"></script>
    <script type="text/javascript" src="/media/js/protovis.min.js"></script>
    <style type="text/css">

        #fig {
          width: 250px;
          height: 200px;
        }

    </style>
  </head>

  <body>
  <div id="center">
         <div id="fig">
    <script type="text/javascript+protovis">
   
        var senders = {{ senders|safe }},
            times = {{ times|safe }}
            simTime = {{ simTime|safe }},
            neurons = {{ neurons|safe }},
            nr_bins = {{ nr_bins|safe }};


	  $(function() {
		  $( "#"+ nr_bins +"_bins").attr('checked', true);
	  });

	  $( "form#nr_bins" ).live('change',function(e) {
			$(this).submit();
		});
          
          
        var data = pv.range(0, senders.length).map(function(i) {
                return {x: times[i], y: senders[i]};
                });

      var draw = function(nr_bins) {

                  /* Sizing and scales. */
                  var w = 230,
                  h1 = neurons.length * 15,
                  h2 = 30,
                  x = pv.Scale.linear(0, simTime).range(0, w),
                  y = pv.Scale.linear(1, neurons.length).range(0, h1),
                  bins = pv.histogram(times).bins(x.ticks(nr_bins)),
                  bin_height = pv.Scale.linear(0, pv.max(bins, function(d) d.y)).range(0, h2);


          /* The root panel. */
          var vis = new pv.Panel()
                  .width(w)
                  .height(h1 + 50 + h2)
                  .bottom(5)
                  .left(15)
                  .right(5)
                  .top(5);

          /* The spike panel. */
          var spikes = vis.add(pv.Panel)
                  .top(0)
                  .height(h1);    

          /* Y-axis and ticks. */
          spikes.add(pv.Rule)
                  .data(neurons)
                  .top(y)
                  .strokeStyle(function(d) d ? "#eee" : "#000")
                .anchor("left").add(pv.Label)
                  .text(y.tickFormat);

          /* X-axis and ticks. */
          spikes.add(pv.Rule)
                  .data(x.ticks(nr_bins))
                  .left(x)
                  .strokeStyle(function(d) d ? "#eee" : "#000")

          /* The dot plot! */
          spikes.add(pv.Dot)
                  .data(data)
                  .left(function(d) x(d.x))
                  .top(function(d) y(d.y))
                  .strokeStyle("#000")
                  .size(1);

          /* X-axis label */
          spikes.add(pv.Label)
                  .bottom(-1)
                  .textBaseline("top")
                  .left(w/2)
                  .textAlign("center")
                  .text("Time (ms)")
                .add(pv.Label)
                  .bottom(-1)
                  .textBaseline("top")
                  .left(0)
                  .textAlign("left")
                  .text(senders.length +" spikes");

          /* The PSTH panel */
          var psth = vis.add(pv.Panel)
                  .bottom(10)
                  .height(h2);

          /* the bar plot! */
          psth.add(pv.Bar)
                  .data(bins)
                  .bottom(0)
                  .left(function(d) x(d.x))
                  .width(function(d) x(d.dx))
                  .height(function(d) bin_height(d.y))
                  .fillStyle("#000")
                  .strokeStyle("rgba(255, 255, 255, .2)")
                  .lineWidth(1)
                .anchor("top").add(pv.Label)
                  .textBaseline("bottom")
                  .text(function(d) d.y);

          psth.add(pv.Line)
                  .data(bins)
                  .left(function(d) x(d.x) + x(d.dx)/2)
                  .bottom(function(d) bin_height(d.y));

          psth.add(pv.Label)
                  .bottom(-1)
                  .textBaseline("top")
                  .left(w/2)
                  .textAlign("center")
                  .text("PSTH in " + nr_bins + " bins");

          vis.render();
        }

        draw(nr_bins);

    </script>

    <form method="GET" id="nr_bins">
        <input type="radio" name="nr_bins" value="1" id="1_bins"> 1 
        <input type="radio" name="nr_bins" value="5" id="5_bins"> 5 
        <input type="radio" name="nr_bins" value="10" id="10_bins"> 10
        <input type="radio" name="nr_bins" value="20" id="20_bins"> 20
        bins
    </form>
  </div></div>
</body>
</html>
